# Sprint Change Proposal: Epic 2 & 3 Refactoring (Dependency Resolution)

**Date:** 2025-12-29
**Status:** DRAFT (For Approval)
**Handoff Scope:** Moderate (Requires Backlog Reorganization)

---

## Section 1: Issue Summary

### Problem Statement
A critical forward dependency was identified during the "Implementation Readiness Assessment" between **Epic 2 (Manuscript Editor & Llama AI)** and **Epic 3 (Consistency Engine)**. Specifically, **Story 2.3 (Real-Time Llama Suggestions)** required **Story 3.3 (AI Usage Metering)** to enforce token caps and cost safety. This violated the BMad Method principle of independent, deliverable epics—Epic 2 could not be shipped without implementation work from Epic 3.

### Discovery Context
Identified during Step 5 (Epic Quality Review) of the Implementation Readiness workflow. The dependency was explicitly listed in the story metadata but not account for in the epic sequencing.

---

## Section 2: Impact Analysis

### Epic & Story Impact
- **Epic 2 (Editor & AI)**:
    - **Added Story 2.5**: AI Usage Metering & Hard Caps (Moved from Epic 3).
    - **Renumbered Story 2.6**: Magic Ingest (Formerly 2.5).
    - **Effort Increase**: +20 hours (Total: 120h).
- **Epic 3 (Consistency Engine)**:
    - **Removed Story 3.3**: AI Usage Metering.
    - **Effort Decrease**: -20 hours (Total: 46h).

### Artifact Conflicts
- **PRD**: Updated Section 6 (Epics & Stories) to reflect the new distribution.
- **Architecture**: `architecture-index.md` and `architecture-ai.md` updated to assign Metering to Epic 2.
- **Project Tracking**: `bmm-workflow-status.yaml` and `sprint-status.yaml` require synchronization of story IDs and counts.

---

## Section 3: Recommended Approach

### Direct Adjustment (Selected)
We have chosen to perform a direct adjustment of the epic plans. By moving the Metering story into Epic 2, we resolve the dependency deadlock while maintaining a clean "Foundation → Editor → AI" layering.

### Rationale
- **Feasibility**: Enables Epic 2 to be 100% deliverable and cost-safe upon completion.
- **Risk Mitigation**: Prevents "scope bleed" where Epic 2 development is constantly interrupted by needing Epic 3 features.
- **Timeline**: No net change to project effort; simply a re-allocation of hours between phases.

---

## Section 4: Detailed Change Proposals

### Artifact: `prd-epic-2.md`
**OLD:** 4 Stories (2.1 to 2.4).
**NEW:** 5 Stories (2.1 to 2.5). Added Story 2.5 (AI Usage Metering) as a base requirement for Story 2.3.

### Artifact: `prd-epic-3.md`
**OLD:** 3 Stories (3.1 to 3.3).
**NEW:** 2 Stories (3.1 to 3.2). Metering removed as it is now a prerequisite provided by Epic 2.

### Artifact: `sprint-status.yaml`
**OLD:** 
- `3-3-ai-usage-metering`: backlog (Epic 3)
- `epic-2`: done
**NEW:**
- `2-5-ai-usage-metering`: done (Moved to Epic 2)
- `2-6-magic-ingest`: backlog
- `epic-2`: in-progress (Updated to reflect new story backlog)

---

## Section 5: Implementation Handoff

### Receiver: Scrum Master / Story Manager
**Responsibilities:**
- Synchronize all task tracking systems with the new story IDs (2.5 Metering, 2.6 Magic Ingest).
- Update the Sprint Status file to correctly reflect the "In Progress" status of Epic 2 due to the new stories.

### Success Criteria
- [ ] No stories in Epic 2 depend on stories in Epic 3 or later.
- [ ] Automated tests for Llama suggestions (2.3) include validation of the metering logic (2.5).
- [ ] Sprint Status reports 12 completed stories out of a total of 21.

---
**Proposal generated by Antigravity (BMM PM Agent)**
