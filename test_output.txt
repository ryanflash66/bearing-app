
> bearing-app@1.0.0 test
> jest tests/api/tickets.test.ts

FAIL tests/api/tickets.test.ts
  POST /api/support/tickets
    ΓêÜ should return 401 if user is not authenticated (3 ms)
    ├ù should create a ticket and return 200 (1 ms)
    ├ù should create an initial message in support_messages (1 ms)

  ΓùÅ POST /api/support/tickets ΓÇ║ should create a ticket and return 200

    TypeError: supabase.rpc is not a function

      30 |   // RPC-First: Use create_ticket function
      31 |   // This handles: rate limiting, ticket creation, initial message creation
    > 32 |   const { data: ticketId, error: rpcError } = await supabase.rpc("create_ticket", {
         |                                                              ^
      33 |     subject,
      34 |     message,
      35 |     priority,

      at rpc (src/app/api/support/tickets/route.ts:32:62)
      at Object.<anonymous> (tests/api/tickets.test.ts:91:17)

  ΓùÅ POST /api/support/tickets ΓÇ║ should create an initial message in support_messages

    TypeError: supabase.rpc is not a function

      30 |   // RPC-First: Use create_ticket function
      31 |   // This handles: rate limiting, ticket creation, initial message creation
    > 32 |   const { data: ticketId, error: rpcError } = await supabase.rpc("create_ticket", {
         |                                                              ^
      33 |     subject,
      34 |     message,
      35 |     priority,

      at rpc (src/app/api/support/tickets/route.ts:32:62)
      at Object.<anonymous> (tests/api/tickets.test.ts:142:5)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 1 passed, 3 total
Snapshots:   0 total
Time:        1.277 s
Ran all test suites matching tests/api/tickets.test.ts.
